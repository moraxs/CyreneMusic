# ğŸ§ª é‚®ä»¶æœåŠ¡ä¿®å¤éªŒè¯æŒ‡å—

## âœ… ä¿®å¤å†…å®¹

å·²ä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼š
1. âŒ **æ—§é—®é¢˜**: é‚®ä»¶é…ç½®é”™è¯¯ï¼ˆç«¯å£80ä¸SSLå†²çªï¼‰
2. âŒ **æ—§é—®é¢˜**: ç¼ºå°‘é…ç½®å¯¼è‡´è§£æ„èµ‹å€¼å¤±è´¥
3. âœ… **æ–°æ–¹æ¡ˆ**: æ‰€æœ‰é…ç½®é›†ä¸­åœ¨ `config.json` ä¸­ç®¡ç†
4. âœ… **å·²é…ç½®**: é˜¿é‡Œäº‘ä¼ä¸šé‚®ç®±ï¼Œæ”¯æŒçœŸå®é‚®ä»¶å‘é€

---

## ğŸ“‹ å½“å‰é…ç½®

### config.json
```json
{
  "bili_proxy": {
    "enabled": true,
    "url": "http://47.104.188.206:4056"
  },
  "log_level": "DEV",
  "EMAIL": {
    "host": "smtp.qiye.aliyun.com",
    "port": 465,
    "secure": true,
    "auth": {
      "user": "noreply@cialloo.site",
      "pass": "Qwaszx1233"
    },
    "tls": {
      "rejectUnauthorized": false
    }
  }
}
```

**å·¥ä½œæ¨¡å¼**: ç”Ÿäº§æ¨¡å¼ï¼ˆçœŸå®é‚®ä»¶å‘é€ï¼‰

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### 1ï¸âƒ£ é‡å¯åç«¯æœåŠ¡

```bash
cd backend
bun run dev
```

### 2ï¸âƒ£ æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š
```
Server running at http://0.0.0.0:4055
[INFO ] - [Config] Loaded config.json successfully.
[INFO ] - [Config] Log level: DEV
  === User Authentication ===
  - POST /auth/register/send-code (Send Register Code)
  - POST /auth/register (Register)
  - POST /auth/login (Login)
  - POST /auth/reset-password/send-code (Send Reset Code)
  - POST /auth/reset-password (Reset Password)
```

### 3ï¸âƒ£ æµ‹è¯•å‘é€éªŒè¯ç 

**ä½¿ç”¨ curl æµ‹è¯•ï¼š**

```bash
curl -X POST http://127.0.0.1:4055/auth/register/send-code \
  -H "Content-Type: application/json" \
  -d '{
    "email": "your-test-email@example.com",
    "username": "testuser123"
  }'
```

âš ï¸ **é‡è¦**: è¯·ä½¿ç”¨çœŸå®çš„é‚®ç®±åœ°å€è¿›è¡Œæµ‹è¯•ï¼

### 4ï¸âƒ£ éªŒè¯ç»“æœ

#### âœ… æˆåŠŸçš„å“åº”ï¼ˆHTTP 200ï¼‰

```json
{
  "code": 200,
  "message": "éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼Œè¯·æŸ¥æ”¶",
  "data": {
    "email": "your-test-email@example.com",
    "expiresIn": 600
  }
}
```

#### âœ… åç«¯æ—¥å¿—è¾“å‡º

```
2025-10-01 00:30:00 [INFO ] - [Auth] æ³¨å†ŒéªŒè¯ç å·²å‘é€åˆ° your-test-email@example.com
```

#### âœ… æ£€æŸ¥é‚®ç®±

1. æ‰“å¼€ä½ çš„æµ‹è¯•é‚®ç®±
2. æŸ¥æ‰¾æ¥è‡ª `Cyrene Music <noreply@cialloo.site>` çš„é‚®ä»¶
3. ä¸»é¢˜ï¼š**æ¬¢è¿æ³¨å†Œ Cyrene Music - éªŒè¯æ‚¨çš„é‚®ç®±**
4. é‚®ä»¶ä¸­ä¼šæ˜¾ç¤º 6 ä½æ•°å­—éªŒè¯ç 

---

## ğŸ“ å®Œæ•´æ³¨å†Œæµç¨‹æµ‹è¯•

### æ­¥éª¤ 1: å‘é€éªŒè¯ç 
```bash
curl -X POST http://127.0.0.1:4055/auth/register/send-code \
  -H "Content-Type: application/json" \
  -d '{
    "email": "your-email@example.com",
    "username": "testuser123"
  }'
```

### æ­¥éª¤ 2: æ£€æŸ¥é‚®ç®±ï¼Œè·å–éªŒè¯ç 
- æ‰“å¼€é‚®ç®±ï¼ŒæŸ¥æ‰¾éªŒè¯ç ï¼ˆä¾‹å¦‚ï¼š`123456`ï¼‰
- éªŒè¯ç æœ‰æ•ˆæœŸï¼š10 åˆ†é’Ÿ

### æ­¥éª¤ 3: å®Œæˆæ³¨å†Œ
```bash
curl -X POST http://127.0.0.1:4055/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "your-email@example.com",
    "username": "testuser123",
    "password": "SecurePassword123!",
    "code": "123456"
  }'
```

**æˆåŠŸå“åº”ï¼š**
```json
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "id": 1,
    "email": "your-email@example.com",
    "username": "testuser123",
    "createdAt": "2025-10-01T00:30:00.000Z"
  }
}
```

### æ­¥éª¤ 4: ç™»å½•æµ‹è¯•
```bash
curl -X POST http://127.0.0.1:4055/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "account": "testuser123",
    "password": "SecurePassword123!"
  }'
```

**æˆåŠŸå“åº”ï¼š**
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "id": 1,
    "email": "your-email@example.com",
    "username": "testuser123",
    "isVerified": true,
    "lastLogin": "2025-10-01T00:35:00.000Z"
  }
}
```

---

## ğŸ”„ æµ‹è¯•å¯†ç é‡ç½®åŠŸèƒ½

### æ­¥éª¤ 1: å‘é€é‡ç½®å¯†ç éªŒè¯ç 
```bash
curl -X POST http://127.0.0.1:4055/auth/reset-password/send-code \
  -H "Content-Type: application/json" \
  -d '{
    "email": "your-email@example.com"
  }'
```

### æ­¥éª¤ 2: æ£€æŸ¥é‚®ç®±è·å–éªŒè¯ç 
- ä¸»é¢˜ï¼š**Cyrene Music - é‡ç½®å¯†ç éªŒè¯ç **
- è·å– 6 ä½æ•°å­—éªŒè¯ç 

### æ­¥éª¤ 3: é‡ç½®å¯†ç 
```bash
curl -X POST http://127.0.0.1:4055/auth/reset-password \
  -H "Content-Type: application/json" \
  -d '{
    "email": "your-email@example.com",
    "code": "654321",
    "newPassword": "NewSecurePassword123!"
  }'
```

### æ­¥éª¤ 4: ä½¿ç”¨æ–°å¯†ç ç™»å½•
```bash
curl -X POST http://127.0.0.1:4055/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "account": "your-email@example.com",
    "password": "NewSecurePassword123!"
  }'
```

---

## âŒ å¯èƒ½çš„é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1: `è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ`
**åŸå› **: è¯¥é‚®ç®±å·²ç»æ³¨å†Œè¿‡äº†  
**è§£å†³**: 
- æ›´æ¢é‚®ç®±åœ°å€
- æˆ–åˆ é™¤æ•°æ®åº“é‡æ–°æµ‹è¯•ï¼š
  ```bash
  rm backend/data/users.db
  ```

### é”™è¯¯ 2: `éªŒè¯ç æ— æ•ˆæˆ–å·²è¿‡æœŸ`
**åŸå› **: 
- éªŒè¯ç è¾“å…¥é”™è¯¯ï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰ç©ºæ ¼ï¼‰
- éªŒè¯ç å·²è¿‡æœŸï¼ˆ10åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
- éªŒè¯ç å·²è¢«ä½¿ç”¨ï¼ˆæ¯ä¸ªéªŒè¯ç åªèƒ½ç”¨ä¸€æ¬¡ï¼‰

**è§£å†³**: é‡æ–°å‘é€éªŒè¯ç 

### é”™è¯¯ 3: `ç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®`
**åŸå› **: ç”¨æˆ·åä¸ç¬¦åˆè¦æ±‚  
**è¦æ±‚**: 4-20ä¸ªå­—ç¬¦ï¼Œä»…å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿  
**ç¤ºä¾‹**: âœ… `user123`, `test_user` | âŒ `us`, `user@123`, `ç”¨æˆ·å`

### é”™è¯¯ 4: `å¯†ç é•¿åº¦è‡³å°‘ä¸º8ä¸ªå­—ç¬¦`
**åŸå› **: å¯†ç å¤ªçŸ­  
**è§£å†³**: ä½¿ç”¨è‡³å°‘ 8 ä¸ªå­—ç¬¦çš„å¯†ç ï¼Œå»ºè®®åŒ…å«å­—æ¯ã€æ•°å­—ã€ç¬¦å·

### é”™è¯¯ 5: é‚®ä»¶å‘é€å¤±è´¥
**å¯èƒ½åŸå› **:
- SMTP æœåŠ¡å™¨è¿æ¥å¤±è´¥
- é‚®ç®±è´¦å·æˆ–å¯†ç é”™è¯¯
- ç½‘ç»œé˜²ç«å¢™é˜»æ­¢ 465 ç«¯å£

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ `config.json` ä¸­çš„ `EMAIL` é…ç½®
2. ç¡®è®¤ SMTP æœåŠ¡å™¨åœ°å€å’Œç«¯å£æ­£ç¡®
3. æµ‹è¯•ç½‘ç»œè¿æ¥ï¼š
   ```bash
   telnet smtp.qiye.aliyun.com 465
   ```
4. æŸ¥çœ‹åç«¯è¯¦ç»†é”™è¯¯æ—¥å¿—

---

## ğŸ”„ åˆ‡æ¢åˆ°å¼€å‘æ¨¡å¼ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æƒ³ä¸´æ—¶ç¦ç”¨çœŸå®é‚®ä»¶å‘é€ï¼Œåªåœ¨æ§åˆ¶å°è¾“å‡ºéªŒè¯ç ï¼š

### æ–¹æ³•ï¼šç§»é™¤ EMAIL é…ç½®

ç¼–è¾‘ `backend/config.json`ï¼š
```json
{
  "bili_proxy": {
    "enabled": true,
    "url": "http://47.104.188.206:4056"
  },
  "log_level": "DEV"
  // ç§»é™¤æˆ–æ³¨é‡Šæ‰ EMAIL å­—æ®µ
}
```

é‡å¯æœåŠ¡åï¼ŒéªŒè¯ç ä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ï¼š
```
[INFO ] - [DEV MODE] æ³¨å†ŒéªŒè¯ç  - é‚®ç®±: test@example.com, ç”¨æˆ·å: testuser123, éªŒè¯ç : 123456
[WARN ] - [DEV MODE] é‚®ä»¶æœªå®é™…å‘é€ - éªŒè¯ç å°†åœ¨ 10 åˆ†é’Ÿåè¿‡æœŸ
```

---

## ğŸ¯ é¢„æœŸè¡Œä¸ºå¯¹æ¯”

### âŒ ä¿®å¤å‰ï¼ˆé”™è¯¯çŠ¶æ€ï¼‰
```
2025-10-01 00:05:01 [ERROR] - [Auth] å‘é€æ³¨å†ŒéªŒè¯ç å¤±è´¥: Right side of assignment cannot be destructured
```

### âœ… ä¿®å¤åï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
```
2025-10-01 00:30:00 [INFO ] - [Auth] æ³¨å†ŒéªŒè¯ç å·²å‘é€åˆ° your-email@example.com
```

**é‚®ç®±æ”¶åˆ°ç²¾ç¾çš„ HTML é‚®ä»¶ï¼š**
- ğŸµ Cyrene Music å“ç‰Œ Logo
- 6 ä½æ•°å­—éªŒè¯ç ï¼ˆå¤§å­—ä½“æ˜¾ç¤ºï¼‰
- 10 åˆ†é’Ÿå€’è®¡æ—¶æç¤º
- å®‰å…¨æç¤ºä¿¡æ¯

---

## ğŸ” æ•…éšœæ’æŸ¥

### æ£€æŸ¥ 1: ç¡®è®¤æœåŠ¡æ­£å¸¸è¿è¡Œ
```bash
curl http://127.0.0.1:4055/
```
åº”è¯¥è¿”å›: `OK`

### æ£€æŸ¥ 2: æŸ¥çœ‹é…ç½®æ˜¯å¦åŠ è½½
```bash
cat backend/config.json | grep EMAIL
```
ç¡®è®¤ `EMAIL` å­—æ®µå­˜åœ¨ä¸”é…ç½®æ­£ç¡®

### æ£€æŸ¥ 3: æµ‹è¯• SMTP è¿æ¥
```bash
# Windows (PowerShell)
Test-NetConnection smtp.qiye.aliyun.com -Port 465

# Linux/macOS
telnet smtp.qiye.aliyun.com 465
# æˆ–
nc -zv smtp.qiye.aliyun.com 465
```

### æ£€æŸ¥ 4: æŸ¥çœ‹æ•°æ®åº“
```bash
# æŸ¥çœ‹ç”¨æˆ·è¡¨
sqlite3 backend/data/users.db "SELECT * FROM users;"

# æŸ¥çœ‹æœ€è¿‘çš„éªŒè¯ç è®°å½•
sqlite3 backend/data/users.db "SELECT * FROM verification_codes ORDER BY created_at DESC LIMIT 5;"

# æŸ¥çœ‹ç‰¹å®šé‚®ç®±çš„éªŒè¯ç 
sqlite3 backend/data/users.db "SELECT * FROM verification_codes WHERE email='your-email@example.com' ORDER BY created_at DESC;"
```

### æ£€æŸ¥ 5: æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
ç¡®ä¿ `config.json` ä¸­ `log_level` è®¾ç½®ä¸º `"DEV"`ï¼Œå¯ä»¥çœ‹åˆ°å®Œæ•´çš„è¯·æ±‚å’Œå“åº”æ•°æ®ã€‚

---

## ğŸ“§ é‚®ä»¶å†…å®¹é¢„è§ˆ

### æ³¨å†ŒéªŒè¯é‚®ä»¶
```
ä¸»é¢˜: æ¬¢è¿æ³¨å†Œ Cyrene Music - éªŒè¯æ‚¨çš„é‚®ç®±
å‘ä»¶äºº: Cyrene Music <noreply@cialloo.site>

ä½ å¥½ï¼Œtestuser123ï¼

æ„Ÿè°¢æ‚¨æ³¨å†Œ Cyrene Musicï¼
ä¸ºäº†ç¡®ä¿æ‚¨çš„è´¦æˆ·å®‰å…¨ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹éªŒè¯ç å®Œæˆæ³¨å†Œï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‚¨çš„éªŒè¯ç       â”‚
â”‚    123456       â”‚
â”‚ â° 10åˆ†é’Ÿåè¿‡æœŸ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ å®‰å…¨æç¤ºï¼šè¯·å‹¿å°†æ­¤éªŒè¯ç åˆ†äº«ç»™ä»»ä½•äººã€‚
```

### å¯†ç é‡ç½®é‚®ä»¶
```
ä¸»é¢˜: Cyrene Music - é‡ç½®å¯†ç éªŒè¯ç 
å‘ä»¶äºº: Cyrene Music <noreply@cialloo.site>

ä½ å¥½ï¼Œtestuser123ï¼

æˆ‘ä»¬æ”¶åˆ°äº†æ‚¨é‡ç½®å¯†ç çš„è¯·æ±‚ã€‚
è¯·ä½¿ç”¨ä»¥ä¸‹éªŒè¯ç æ¥é‡ç½®æ‚¨çš„å¯†ç ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   éªŒè¯ç         â”‚
â”‚    654321       â”‚
â”‚ â° 10åˆ†é’Ÿåè¿‡æœŸ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ é‡è¦å®‰å…¨æç¤ºï¼š
â€¢ è¯·å‹¿å°†æ­¤éªŒè¯ç åˆ†äº«ç»™ä»»ä½•äºº
â€¢ å¦‚æœæ‚¨æ²¡æœ‰è¯·æ±‚é‡ç½®å¯†ç ï¼Œè¯·ç«‹å³è”ç³»æˆ‘ä»¬
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. å®Œæ•´çš„é”™è¯¯æ—¥å¿—ï¼ˆåŒ…æ‹¬æ—¶é—´æˆ³ï¼‰
2. è¯·æ±‚çš„ JSON æ•°æ®
3. åç«¯æ§åˆ¶å°è¾“å‡º
4. `backend/config.json` å†…å®¹ï¼ˆç§»é™¤å¯†ç ï¼‰
5. ç½‘ç»œç¯å¢ƒä¿¡æ¯ï¼ˆæ˜¯å¦æœ‰é˜²ç«å¢™/ä»£ç†ï¼‰

---

## ğŸ‰ æµ‹è¯•æˆåŠŸæ ‡å¿—

ç¡®è®¤ä»¥ä¸‹æ‰€æœ‰é¡¹ç›®éƒ½æˆåŠŸï¼š

- [x] âœ… æœåŠ¡å¯åŠ¨æ— é”™è¯¯
- [x] âœ… å‘é€éªŒè¯ç æ¥å£è¿”å› 200
- [x] âœ… åç«¯æ—¥å¿—æ˜¾ç¤º"éªŒè¯ç å·²å‘é€"
- [x] âœ… ç›®æ ‡é‚®ç®±æ”¶åˆ°éªŒè¯é‚®ä»¶
- [x] âœ… é‚®ä»¶æ ¼å¼ç¾è§‚ï¼ŒéªŒè¯ç æ¸…æ™°
- [x] âœ… éªŒè¯ç å¯ç”¨äºæ³¨å†Œ
- [x] âœ… æ³¨å†ŒæˆåŠŸ
- [x] âœ… ç™»å½•æˆåŠŸ
- [x] âœ… å¯†ç é‡ç½®åŠŸèƒ½æ­£å¸¸

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [`EMAIL_SETUP.md`](./EMAIL_SETUP.md) - è¯¦ç»†çš„é‚®ä»¶é…ç½®æŒ‡å—
- [`docs/AUTH_API.md`](./docs/AUTH_API.md) - è®¤è¯ API å®Œæ•´æ–‡æ¡£
- [`config.json`](./config.json) - é…ç½®æ–‡ä»¶ç¤ºä¾‹