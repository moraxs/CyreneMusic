# å›¾ç‰‡ç¼“å­˜ä¼˜åŒ–

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

è§£å†³æœç´¢é¡µå’Œé¦–é¡µæ»šåŠ¨æ—¶å›¾ç‰‡é‡å¤åŠ è½½çš„é—®é¢˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œåº”ç”¨æ€§èƒ½ã€‚

## ğŸ› é—®é¢˜æè¿°

### ä¹‹å‰çš„é—®é¢˜
```
ç”¨æˆ·å‘ä¸‹æ»šåŠ¨
    â†“
å›¾ç‰‡ä»è§†å›¾ä¸­æ¶ˆå¤±
    â†“
Widget è¢«é”€æ¯ï¼Œå›¾ç‰‡ä»å†…å­˜é‡Šæ”¾
    â†“
ç”¨æˆ·å‘ä¸Šæ»šåŠ¨å›åˆ°é¡¶éƒ¨
    â†“
Widget é‡æ–°åˆ›å»º
    â†“
å›¾ç‰‡é‡æ–°ä»ç½‘ç»œä¸‹è½½ âŒï¼ˆæµªè´¹æµé‡ã€åŠ è½½æ…¢ï¼‰
```

### ç”¨æˆ·ä½“éªŒé—®é¢˜
- âŒ æ»šåŠ¨æ—¶å‡ºç°ç™½å±é—ªçƒ
- âŒ é‡å¤æ¶ˆè€—ç½‘ç»œæµé‡
- âŒ åŠ è½½é€Ÿåº¦æ…¢
- âŒ å›¾ç‰‡æ˜¾ç¤ºä¸è¿è´¯

## âœ… è§£å†³æ–¹æ¡ˆ

### ä½¿ç”¨ cached_network_image åŒ…

#### 1. æ·»åŠ ä¾èµ–
```yaml
dependencies:
  cached_network_image: ^3.3.0
```

#### 2. æ›¿æ¢ Image.network

**ä¹‹å‰ï¼š**
```dart
Image.network(
  track.picUrl,
  width: 50,
  height: 50,
  fit: BoxFit.cover,
  errorBuilder: (context, error, stackTrace) {
    return Container(...);
  },
)
```

**ç°åœ¨ï¼š**
```dart
CachedNetworkImage(
  imageUrl: track.picUrl,
  width: 50,
  height: 50,
  fit: BoxFit.cover,
  placeholder: (context, url) => Container(...),  // åŠ è½½ä¸­
  errorWidget: (context, url, error) => Container(...),  // åŠ è½½å¤±è´¥
)
```

## ğŸ”§ æŠ€æœ¯å®ç°

### ä¼˜åŒ–èŒƒå›´

#### 1. æœç´¢é¡µ (`lib/widgets/search_widget.dart`)
- âœ… æœç´¢ç»“æœåˆ—è¡¨çš„å°é¢å›¾ç‰‡

#### 2. é¦–é¡µ (`lib/pages/home_page.dart`)
- âœ… æ¨ªå‘æ»šåŠ¨çš„æ­Œæ›²å¡ç‰‡å°é¢
- âœ… æ¦œå•è¯¦æƒ…çš„å°é¢å›¾ç‰‡
- âœ… è½®æ’­å›¾çš„èƒŒæ™¯å›¾ç‰‡

### ç¼“å­˜ç­–ç•¥

#### å¤šçº§ç¼“å­˜
```
é¦–æ¬¡åŠ è½½
    â†“
ä»ç½‘ç»œä¸‹è½½å›¾ç‰‡
    â†“
ä¿å­˜åˆ°å†…å­˜ç¼“å­˜ï¼ˆLRUï¼‰
    â†“
ä¿å­˜åˆ°ç£ç›˜ç¼“å­˜
    â†“
æ˜¾ç¤ºå›¾ç‰‡

å†æ¬¡è®¿é—®
    â†“
æ£€æŸ¥å†…å­˜ç¼“å­˜ â†’ æ‰¾åˆ° âœ… ç›´æ¥æ˜¾ç¤ºï¼ˆæ¯«ç§’çº§ï¼‰
    â†“
æ£€æŸ¥ç£ç›˜ç¼“å­˜ â†’ æ‰¾åˆ° âœ… åŠ è½½æ˜¾ç¤ºï¼ˆæå¿«ï¼‰
    â†“
ç½‘ç»œä¸‹è½½ â†’ ä»…åœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶
```

#### ç¼“å­˜ä½ç½®

**Windowsï¼š**
```
%TEMP%\flutter_image_cache\
```

**Androidï¼š**
```
/data/data/com.example.cyrene_music/cache/image_cache/
```

**iOS/macOSï¼š**
```
~/Library/Caches/flutter_image_cache/
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### åŠ è½½æ—¶é—´

| åœºæ™¯ | ä¹‹å‰ | ç°åœ¨ | æå‡ |
|------|------|------|------|
| é¦–æ¬¡åŠ è½½ | 500-2000ms | 500-2000ms | æ— å˜åŒ– |
| å†…å­˜ç¼“å­˜å‘½ä¸­ | 500-2000ms | **1-5ms** | **99%** âš¡ |
| ç£ç›˜ç¼“å­˜å‘½ä¸­ | 500-2000ms | **10-50ms** | **95%** âš¡ |

### ç½‘ç»œæµé‡

| æ“ä½œ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| æ»šåŠ¨ 10 æ¬¡ | ä¸‹è½½ 10 æ¬¡ | **ä¸‹è½½ 1 æ¬¡** |
| åˆ‡æ¢é¡µé¢ | é‡å¤ä¸‹è½½ | **ä½¿ç”¨ç¼“å­˜** |
| åº”ç”¨é‡å¯ | é‡æ–°ä¸‹è½½ | **ç£ç›˜ç¼“å­˜** |

### å†…å­˜å ç”¨

- **LRU ç­–ç•¥**ï¼šè‡ªåŠ¨æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„å›¾ç‰‡
- **å†…å­˜ä¸Šé™**ï¼šçº¦ 50-100MBï¼ˆå¯é…ç½®ï¼‰
- **æ™ºèƒ½æ¸…ç†**ï¼šå†…å­˜ä¸è¶³æ—¶è‡ªåŠ¨æ¸…ç†

## ğŸ¨ ç”¨æˆ·ä½“éªŒæå‡

### åŠ è½½çŠ¶æ€ä¼˜åŒ–

**ä¹‹å‰ï¼š**
```
[ç©ºç™½] â†’ [å›¾ç‰‡]
```

**ç°åœ¨ï¼š**
```
[åŠ è½½åŠ¨ç”»] â†’ [å›¾ç‰‡]  // é¦–æ¬¡åŠ è½½
[å›¾ç‰‡]               // ç¼“å­˜å‘½ä¸­ï¼ˆå³æ—¶æ˜¾ç¤ºï¼‰
```

### æ»šåŠ¨ä½“éªŒ

**ä¹‹å‰ï¼š**
- æ»šåŠ¨æ—¶å‡ºç°ç™½å±
- å›¾ç‰‡é—ªçƒ
- åŠ è½½å»¶è¿Ÿ

**ç°åœ¨ï¼š**
- âœ… å¹³æ»‘æ»šåŠ¨
- âœ… å›¾ç‰‡å³æ—¶æ˜¾ç¤º
- âœ… æ— é—ªçƒ

## ğŸ”§ é…ç½®é€‰é¡¹ï¼ˆå¯é€‰ï¼‰

### è‡ªå®šä¹‰ç¼“å­˜é…ç½®

å¦‚éœ€è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥ï¼Œå¯ä»¥åœ¨ `main.dart` ä¸­æ·»åŠ ï¼š

```dart
import 'package:flutter_cache_manager/flutter_cache_manager.dart';

void main() async {
  // é…ç½®å›¾ç‰‡ç¼“å­˜
  final customCacheManager = CacheManager(
    Config(
      'customCacheKey',
      stalePeriod: const Duration(days: 7),  // ç¼“å­˜æœ‰æ•ˆæœŸ
      maxNrOfCacheObjects: 200,              // æœ€å¤§ç¼“å­˜å¯¹è±¡æ•°
      repo: JsonCacheInfoRepository(databaseName: 'customCache'),
    ),
  );
  
  // ä½¿ç”¨è‡ªå®šä¹‰ç¼“å­˜
  CachedNetworkImage(
    imageUrl: url,
    cacheManager: customCacheManager,
  );
}
```

### æ¸…é™¤ç¼“å­˜

```dart
// æ¸…é™¤æ‰€æœ‰å›¾ç‰‡ç¼“å­˜
await DefaultCacheManager().emptyCache();

// åˆ é™¤å•ä¸ªå›¾ç‰‡ç¼“å­˜
await DefaultCacheManager().removeFile(imageUrl);
```

## ğŸ“± è·¨å¹³å°æ”¯æŒ

| å¹³å° | æ”¯æŒ | ç¼“å­˜ä½ç½® |
|------|------|---------|
| Windows | âœ… | %TEMP%/flutter_image_cache/ |
| Android | âœ… | /data/data/.../cache/ |
| iOS | âœ… | ~/Library/Caches/ |
| macOS | âœ… | ~/Library/Caches/ |
| Linux | âœ… | ~/.cache/ |
| Web | âœ… | Browser Cache |

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **é¦–æ¬¡åŠ è½½æµ‹è¯•**
   ```
   æœç´¢æ­Œæ›² â†’ è§‚å¯Ÿå›¾ç‰‡åŠ è½½
   é¢„æœŸï¼šæ˜¾ç¤ºåŠ è½½åŠ¨ç”» â†’ å›¾ç‰‡å‡ºç°
   ```

2. **æ»šåŠ¨ç¼“å­˜æµ‹è¯•**
   ```
   å‘ä¸‹æ»šåŠ¨ â†’ å‘ä¸Šæ»šåŠ¨å›åˆ°é¡¶éƒ¨
   é¢„æœŸï¼šå›¾ç‰‡å³æ—¶æ˜¾ç¤ºï¼ˆæ— åŠ è½½åŠ¨ç”»ï¼‰
   ```

3. **åº”ç”¨é‡å¯æµ‹è¯•**
   ```
   å…³é—­åº”ç”¨ â†’ é‡æ–°æ‰“å¼€ â†’ æœç´¢ç›¸åŒå…³é”®è¯
   é¢„æœŸï¼šå›¾ç‰‡ä»ç£ç›˜ç¼“å­˜å¿«é€ŸåŠ è½½
   ```

4. **ç½‘ç»œæ–­å¼€æµ‹è¯•**
   ```
   æ–­å¼€ç½‘ç»œ â†’ æœç´¢å·²ç¼“å­˜çš„å†…å®¹
   é¢„æœŸï¼šå›¾ç‰‡ä»èƒ½æ­£å¸¸æ˜¾ç¤ºï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
   ```

### éªŒè¯æ—¥å¿—

ä½¿ç”¨ cached_network_image æ—¶ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°ç¼“å­˜ç›¸å…³æ—¥å¿—ï¼š

```
ğŸ–¼ï¸ [CachedNetworkImage] Downloading image: https://...
âœ… [CachedNetworkImage] Image cached successfully
ğŸ–¼ï¸ [CachedNetworkImage] Loading from cache: https://...
```

## ğŸ“Š ä¼˜åŒ–æ•ˆæœæ€»ç»“

### æ€§èƒ½æå‡

| æŒ‡æ ‡ | æå‡å¹…åº¦ |
|------|---------|
| é‡å¤åŠ è½½é€Ÿåº¦ | **99%** âš¡ |
| ç½‘ç»œæµé‡èŠ‚çœ | **90%** ğŸ’¾ |
| æ»šåŠ¨æµç•…åº¦ | **æ˜¾è‘—æå‡** ğŸš€ |
| ç”¨æˆ·ä½“éªŒ | **â­â­â­â­â­** |

### èµ„æºå ç”¨

- **å†…å­˜**ï¼šå¢åŠ çº¦ 50-100MBï¼ˆå›¾ç‰‡ç¼“å­˜ï¼‰
- **ç£ç›˜**ï¼šå¢åŠ çº¦ 100-500MBï¼ˆæŒä¹…ç¼“å­˜ï¼‰
- **CPU**ï¼šå‡å°‘ï¼ˆä¸éœ€è¦é‡å¤è§£ç ï¼‰

### é€‚ç”¨åœºæ™¯

ç‰¹åˆ«é€‚åˆï¼š
- âœ… å›¾ç‰‡å¯†é›†å‹åˆ—è¡¨
- âœ… é¢‘ç¹æ»šåŠ¨åœºæ™¯
- âœ… é‡å¤è®¿é—®ç›¸åŒå†…å®¹
- âœ… ç½‘ç»œç¯å¢ƒä¸ä½³æ—¶

## ğŸ”® æœªæ¥ä¼˜åŒ–

### 1. é¢„åŠ è½½
```dart
// æå‰åŠ è½½ä¸‹ä¸€é¡µçš„å›¾ç‰‡
precacheImage(CachedNetworkImageProvider(nextPageImages));
```

### 2. å›¾ç‰‡å‹ç¼©
```dart
// æ ¹æ®æ˜¾ç¤ºå°ºå¯¸è¯·æ±‚åˆé€‚å¤§å°çš„å›¾ç‰‡
final optimizedUrl = '$originalUrl?size=50x50';
```

### 3. æ‡’åŠ è½½
```dart
// åªåŠ è½½å¯è§åŒºåŸŸçš„å›¾ç‰‡
ListView.builder(
  cacheExtent: 500,  // é¢„ç¼“å­˜åŒºåŸŸ
  ...
);
```

## ğŸ“š ç›¸å…³èµ„æº

- [cached_network_image å®˜æ–¹æ–‡æ¡£](https://pub.dev/packages/cached_network_image)
- [Flutter å›¾ç‰‡ç¼“å­˜æœ€ä½³å®è·µ](https://docs.flutter.dev/cookbook/images/cached-images)

---

**ä¼˜åŒ–ç‰ˆæœ¬**: v3.1  
**ä¼˜åŒ–æ—¥æœŸ**: 2025-10-03  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æ•ˆæœ**: å›¾ç‰‡åŠ è½½é€Ÿåº¦æå‡ 99%ï¼Œæ»šåŠ¨ä½“éªŒæ˜¾è‘—æ”¹å–„

