# Windows 系统强调色测试指南

## 📋 测试目的

验证 Cyrene Music 能否正确读取并应用 Windows 系统的强调色设置。

---

## ✅ 测试步骤

### 步骤 1：查看当前系统强调色

1. 打开 **Windows 设置**（`Win + I`）
2. 进入 **个性化 > 颜色**
3. 查看当前选择的"强调色"

![Windows 个性化设置](https://via.placeholder.com/600x400?text=Windows+个性化+>+颜色)

### 步骤 2：运行应用并查看主题色

1. 重新编译并运行应用：
   ```bash
   flutter run -d windows
   ```

2. 进入 **设置页面**

3. 查看 **外观** 分类：
   - **跟随系统主题色**：应该是**开启**状态
   - **主题色**：应该显示 `系统主题色 (当前跟随系统)`

4. 观察应用的整体主题色是否与系统强调色一致

### 步骤 3：更改系统强调色并验证

1. 回到 **Windows 设置 > 个性化 > 颜色**

2. 选择一个**不同的强调色**（例如从蓝色改为绿色）

3. **重新启动** Cyrene Music

4. 查看应用主题色是否已更新为新的强调色

### 步骤 4：测试不同的颜色

建议测试以下几种颜色，确保都能正确识别：

| 颜色 | 预期效果 |
|------|---------|
| 🔵 蓝色 | 应用显示蓝色主题 |
| 🟢 绿色 | 应用显示绿色主题 |
| 🟣 紫色 | 应用显示紫色主题 |
| 🔴 红色 | 应用显示红色主题 |
| 🟠 橙色 | 应用显示橙色主题 |
| 🩶 蓝灰色 | 应用显示蓝灰色主题 ⭐ **重点测试** |

---

## 🔍 查看调试日志

应用启动时会在控制台输出系统颜色信息：

### 正常日志示例

```
🎨 [ThemeManager] 初始化：跟随系统主题色已启用
🎨 [SystemThemeColor] 尝试获取 Windows 系统强调色...
[SystemColor] 成功读取系统强调色: 0xFFA4C2F4
✅ [SystemThemeColor] 成功获取 Windows 系统强调色: 0xFFA4C2F4
   颜色值: A=255, R=164, G=194, B=244
✅ [ThemeManager] 已应用系统主题色: 0xffa4c2f4
```

### 失败日志示例（需要修复）

```
🎨 [ThemeManager] 初始化：跟随系统主题色已启用
🎨 [SystemThemeColor] 尝试获取 Windows 系统强调色...
[SystemColor] 无法打开注册表项: 2
[SystemColor] 无法读取系统强调色，使用默认值
✅ [SystemThemeColor] 成功获取 Windows 系统强调色: 0xFF0078D4
   颜色值: A=255, R=0, G=120, B=212
```

---

## 🐛 常见问题排查

### 问题 1：应用显示的颜色与系统不一致

**可能原因**：
- 未重启应用
- 注册表权限不足
- Windows 版本过旧

**解决方案**：
1. 完全关闭应用并重新启动
2. 以管理员权限运行应用
3. 检查 Windows 版本（建议 Windows 10 或更高）

### 问题 2：控制台显示"无法读取注册表"

**可能原因**：
- 注册表路径不存在
- 权限不足

**解决方案**：
1. 手动检查注册表：
   - 打开 `regedit`
   - 导航到：`HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\DWM`
   - 查找 `ColorizationColor` 键

2. 如果键不存在，说明系统未设置强调色

### 问题 3：应用一直使用默认蓝色

**可能原因**：
- "跟随系统主题色"开关被关闭
- 平台通道未正确注册
- 编译错误

**解决方案**：
1. 检查设置中的开关是否开启
2. 清理并重新编译：
   ```bash
   flutter clean
   flutter build windows
   ```

---

## 🧪 高级测试

### 测试注册表读取（可选）

如果想验证注册表值，可以手动查询：

```powershell
# PowerShell 命令
$key = "HKCU:\SOFTWARE\Microsoft\Windows\DWM"
$value = Get-ItemProperty -Path $key -Name "ColorizationColor"
$colorHex = "0x{0:X8}" -f $value.ColorizationColor
Write-Host "系统强调色: $colorHex"
```

### 测试不同 Windows 版本

| Windows 版本 | 测试结果 | 备注 |
|-------------|---------|------|
| Windows 11 | ✅ / ❌ | |
| Windows 10 | ✅ / ❌ | |
| Windows 8.1 | ✅ / ❌ | |

---

## 📊 测试报告模板

```markdown
## 测试环境
- Windows 版本：Windows 11 22H2
- 应用版本：v1.0.3
- 测试日期：2025-10-04

## 测试结果
- [ ] 能正确读取系统强调色
- [ ] 蓝色主题测试通过
- [ ] 绿色主题测试通过
- [ ] 紫色主题测试通过
- [ ] 蓝灰色主题测试通过 ⭐
- [ ] 更改系统颜色后能自动更新（需重启应用）

## 问题记录
（如有问题，请详细描述）

## 截图
（粘贴对比截图）
```

---

## ✅ 验收标准

功能完整的标志：

1. ✅ 应用能读取并显示系统强调色
2. ✅ 控制台输出正确的颜色值（ARGB）
3. ✅ 应用 UI 颜色与系统设置一致
4. ✅ 更换系统颜色后重启应用能同步更新
5. ✅ 用户设置的蓝灰色能正确显示（不是默认蓝色）

---

## 🎯 重点验证

**您反馈的问题**：系统设置蓝灰色，应用显示蓝色

**修复后预期**：
- 系统设置：蓝灰色（例如 #A4C2F4）
- 应用显示：蓝灰色（#A4C2F4），不是默认蓝色（#0078D4）

**验证方法**：
1. 设置系统强调色为蓝灰色
2. 重启应用
3. 查看控制台日志中的颜色值
4. 对比应用主题色与系统强调色

如果控制台显示类似 `0xFFA4C2F4` 而不是 `0xFF0078D4`，说明修复成功！

---

**祝测试顺利！** 🎉

